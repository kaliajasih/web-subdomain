<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Subdomain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0B1120',
                        card: '#151e32',
                        border: '#2a3855',
                        input: '#1e293b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark min-h-screen p-4 font-sans text-slate-200">

    <div class="max-w-md mx-auto space-y-6">
        
        <div class="bg-card border border-border rounded-xl shadow-2xl p-6">
            <div class="text-center mb-6">
                <h1 class="text-xl font-bold text-white tracking-wide">DNS MANAGER</h1>
                <p class="text-slate-500 text-xs mt-1">Cloudflare Integration</p>
            </div>

            <div class="flex bg-dark p-1 rounded-lg mb-6 border border-border">
                <button onclick="setMode('create')" id="tabCreate" class="flex-1 py-2 text-sm font-medium rounded-md transition-all text-white bg-blue-600 shadow-lg">Create</button>
                <button onclick="setMode('delete')" id="tabDelete" class="flex-1 py-2 text-sm font-medium rounded-md transition-all text-slate-400 hover:text-white">Delete</button>
            </div>

            <form id="mainForm" class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 uppercase mb-2">Subdomain</label>
                    <div class="flex">
                        <input type="text" id="subdomain" required placeholder="myserver" 
                            class="flex-1 bg-input text-white border border-border rounded-l-lg px-4 py-3 focus:outline-none focus:border-blue-500 text-sm">
                        <span class="bg-dark text-slate-500 border border-l-0 border-border rounded-r-lg px-3 py-3 text-xs flex items-center font-mono">
                            .byfthn.qzz.io
                        </span>
                    </div>
                </div>

                <div id="ipContainer">
                    <label class="block text-xs font-semibold text-slate-500 uppercase mb-2">Target IP</label>
                    <input type="text" id="target" placeholder="192.168.1.1" 
                        class="w-full bg-input text-white border border-border rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 text-sm">
                </div>

                <button type="submit" id="btnSubmit" 
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg text-sm uppercase tracking-wider mt-2">
                    Create Subdomain
                </button>
            </form>

            <div id="message" class="hidden mt-4 p-3 rounded-lg text-xs text-center"></div>
        </div>

        <div class="bg-card border border-border rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-bold text-slate-300">Activity History</h2>
                <button onclick="clearHistory()" class="text-xs text-red-400 hover:text-red-300">Clear</button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left text-xs">
                    <thead>
                        <tr class="text-slate-500 border-b border-border">
                            <th class="pb-2 pl-2">Subdomain</th>
                            <th class="pb-2">Action</th>
                            <th class="pb-2 text-right pr-2">Date</th>
                        </tr>
                    </thead>
                    <tbody id="historyList" class="text-slate-300">
                        <tr><td colspan="3" class="text-center py-4 text-slate-600">No history yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        let currentMode = 'create';
        
        // Load history on start
        document.addEventListener('DOMContentLoaded', renderHistory);

        function setMode(mode) {
            currentMode = mode;
            const tabCreate = document.getElementById('tabCreate');
            const tabDelete = document.getElementById('tabDelete');
            const ipContainer = document.getElementById('ipContainer');
            const btn = document.getElementById('btnSubmit');
            const targetInput = document.getElementById('target');

            if (mode === 'create') {
                tabCreate.className = 'flex-1 py-2 text-sm font-medium rounded-md transition-all text-white bg-blue-600 shadow-lg';
                tabDelete.className = 'flex-1 py-2 text-sm font-medium rounded-md transition-all text-slate-400 hover:text-white';
                ipContainer.style.display = 'block';
                targetInput.required = true;
                btn.className = 'w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg text-sm uppercase tracking-wider mt-2';
                btn.innerText = 'Create Subdomain';
            } else {
                tabCreate.className = 'flex-1 py-2 text-sm font-medium rounded-md transition-all text-slate-400 hover:text-white';
                tabDelete.className = 'flex-1 py-2 text-sm font-medium rounded-md transition-all text-white bg-red-600 shadow-lg';
                ipContainer.style.display = 'none';
                targetInput.required = false;
                btn.className = 'w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg text-sm uppercase tracking-wider mt-2';
                btn.innerText = 'Delete Subdomain';
            }
        }

        document.getElementById('mainForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            const msg = document.getElementById('message');
            const sub = document.getElementById('subdomain').value;
            const ip = document.getElementById('target').value;

            // UI Loading
            btn.disabled = true;
            btn.classList.add('opacity-50');
            btn.innerText = 'Processing...';
            msg.classList.add('hidden');

            const endpoint = currentMode === 'create' ? '/api/create' : '/api/delete';
            const payload = currentMode === 'create' ? { subdomain: sub, target: ip } : { subdomain: sub };

            try {
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await res.json();

                msg.classList.remove('hidden');
                
                if (res.ok) {
                    msg.className = 'mt-4 p-3 rounded-lg text-xs text-center bg-green-900/30 text-green-200 border border-green-800';
                    msg.innerText = result.message;
                    
                    // Add to history
                    addToHistory(sub, currentMode === 'create' ? 'Created' : 'Deleted');
                    
                    // Reset form if create
                    if(currentMode === 'create') document.getElementById('mainForm').reset();
                } else {
                    throw new Error(result.error);
                }
            } catch (err) {
                msg.className = 'mt-4 p-3 rounded-lg text-xs text-center bg-red-900/30 text-red-200 border border-red-800';
                msg.innerText = err.message || 'Error occurred';
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-50');
                btn.innerText = currentMode === 'create' ? 'Create Subdomain' : 'Delete Subdomain';
            }
        });

        // --- History Logic ---
        function addToHistory(sub, action) {
            const history = JSON.parse(localStorage.getItem('dnsHistory') || '[]');
            const newEntry = {
                sub: sub,
                action: action,
                date: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            history.unshift(newEntry); // Add to top
            localStorage.setItem('dnsHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('dnsHistory') || '[]');
            const list = document.getElementById('historyList');
            
            if (history.length === 0) {
                list.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-slate-600">No history yet</td></tr>';
                return;
            }

            list.innerHTML = history.map(item => `
                <tr class="border-b border-gray-800 hover:bg-slate-800/50 transition">
                    <td class="py-3 pl-2 font-mono text-blue-300">${item.sub}</td>
                    <td class="py-3">
                        <span class="${item.action === 'Created' ? 'text-green-400' : 'text-red-400'} bg-opacity-10 px-2 py-0.5 rounded text-[10px] border border-opacity-20 ${item.action === 'Created' ? 'bg-green-400 border-green-400' : 'bg-red-400 border-red-400'}">
                            ${item.action}
                        </span>
                    </td>
                    <td class="py-3 text-right pr-2 text-slate-500 text-[10px]">${item.date}</td>
                </tr>
            `).join('');
        }

        function clearHistory() {
            if(confirm('Clear all history?')) {
                localStorage.removeItem('dnsHistory');
                renderHistory();
            }
        }
    </script>
</body>
    </html>
